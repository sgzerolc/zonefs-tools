## Test 0309: Sequential file mmap read/write

/usr/local/bin/fio
Check sequential file mmap write (should fail)
/dev/vda: 1572864 512-byte sectors (0 GiB)
  Host-managed device
  12 zones of 131072 512-byte sectors (64 MiB)
  0 conventional zones, 12 sequential zones
  0 read-only zones, 0 offline zones
Format:
  11 usable zones
  Aggregate conventional zones: disabled
  File UID: 0
  File GID: 0
  File access permissions: 640
  FS UUID: cfcbd430-4ea2-464e-9014-7cfde9fbcb97
Resetting sequential zones
Writing super block
cnv_mmapwr: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=mmap, iodepth=1
fio-3.32
Starting 1 process
fio: pid=5729, err=22/file:engines/mmap.c:118, func=mmap, error=Invalid argument


Run status group 0 (all jobs):

Disk stats (read/write):
  vda: ios=0/0, merge=0/0, ticks=0/0, in_queue=0, util=0.00%
seqwrite: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=64
fio-3.32
Starting 1 process
seqwrite: Laying out IO file (1 file / 64MiB)

seqwrite: (groupid=0, jobs=1): err= 0: pid=5733: Mon Dec 18 02:11:26 2023
  read: IOPS=1514, BW=379MiB/s (397MB/s)(64.0MiB/169msec)
    slat (nsec): min=13210, max=54272, avg=21565.22, stdev=5150.75
    clat (usec): min=627, max=42586, avg=31577.74, stdev=12920.72
     lat (usec): min=649, max=42608, avg=31599.31, stdev=12922.25
    clat percentiles (usec):
     |  1.00th=[ 1942],  5.00th=[ 5211], 10.00th=[ 9372], 20.00th=[17695],
     | 30.00th=[26084], 40.00th=[34341], 50.00th=[41157], 60.00th=[41157],
     | 70.00th=[41157], 80.00th=[41157], 90.00th=[41157], 95.00th=[41157],
     | 99.00th=[41681], 99.50th=[42206], 99.90th=[42730], 99.95th=[42730],
     | 99.99th=[42730]
  write: IOPS=1347, BW=337MiB/s (353MB/s)(64.0MiB/190msec); 0 zone resets
    slat (usec): min=664, max=1566, avg=730.86, stdev=78.06
    clat (usec): min=371, max=48488, avg=39973.86, stdev=11964.60
     lat (usec): min=1093, max=50054, avg=40704.71, stdev=11980.30
    clat percentiles (usec):
     |  1.00th=[ 1827],  5.00th=[ 8979], 10.00th=[17957], 20.00th=[36439],
     | 30.00th=[44303], 40.00th=[44827], 50.00th=[45876], 60.00th=[45876],
     | 70.00th=[45876], 80.00th=[46400], 90.00th=[46400], 95.00th=[46400],
     | 99.00th=[47449], 99.50th=[47973], 99.90th=[48497], 99.95th=[48497],
     | 99.99th=[48497]
  lat (usec)   : 500=0.20%, 750=0.20%
  lat (msec)   : 2=0.78%, 4=1.56%, 10=5.47%, 20=8.59%, 50=83.20%
  cpu          : usr=92.44%, sys=3.36%, ctx=524, majf=0, minf=22
  IO depths    : 1=0.4%, 2=0.8%, 4=1.6%, 8=3.1%, 16=6.2%, 32=12.5%, >=64=75.4%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=99.5%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.5%, >=64=0.0%
     issued rwts: total=256,256,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=379MiB/s (397MB/s), 379MiB/s-379MiB/s (397MB/s-397MB/s), io=64.0MiB (67.1MB), run=169-169msec
  WRITE: bw=337MiB/s (353MB/s), 337MiB/s-337MiB/s (353MB/s-353MB/s), io=64.0MiB (67.1MB), run=190-190msec

Disk stats (read/write):
  vda: ios=256/256, merge=0/0, ticks=152/92, in_queue=245, util=63.91%
Check sequential file mmap read
seq_rndrd: (g=0): rw=randread, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=mmap, iodepth=1
fio-3.32
Starting 1 process

seq_rndrd: (groupid=0, jobs=1): err= 0: pid=5743: Mon Dec 18 02:11:28 2023
  read: IOPS=130, BW=32.5MiB/s (34.1MB/s)(64.0MiB/1968msec)
    clat (usec): min=5467, max=34835, avg=7052.89, stdev=3368.90
     lat (usec): min=5467, max=34837, avg=7053.19, stdev=3369.00
    clat percentiles (usec):
     |  1.00th=[ 5735],  5.00th=[ 5866], 10.00th=[ 5997], 20.00th=[ 6128],
     | 30.00th=[ 6325], 40.00th=[ 6456], 50.00th=[ 6587], 60.00th=[ 6652],
     | 70.00th=[ 6783], 80.00th=[ 6849], 90.00th=[ 6980], 95.00th=[ 7177],
     | 99.00th=[32375], 99.50th=[33817], 99.90th=[34866], 99.95th=[34866],
     | 99.99th=[34866]
   bw (  KiB/s): min=27136, max=35328, per=97.37%, avg=32426.67, stdev=4589.00, samples=3
   iops        : min=  106, max=  138, avg=126.67, stdev=17.93, samples=3
  lat (msec)   : 10=96.88%, 20=1.56%, 50=1.56%
  cpu          : usr=9.71%, sys=12.10%, ctx=16432, majf=16384, minf=74
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=256,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=32.5MiB/s (34.1MB/s), 32.5MiB/s-32.5MiB/s (34.1MB/s-34.1MB/s), io=64.0MiB (67.1MB), run=1968-1968msec

Disk stats (read/write):
  vda: ios=15756/0, merge=0/0, ticks=1431/0, in_queue=1432, util=94.89%
PASS

