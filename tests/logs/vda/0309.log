## Test 0309: Sequential file mmap read/write

/usr/local/bin/fio
Check sequential file mmap write (should fail)
/dev/vda: 1572864 512-byte sectors (0 GiB)
  Host-managed device
  12 zones of 131072 512-byte sectors (64 MiB)
  0 conventional zones, 12 sequential zones
  0 read-only zones, 0 offline zones
Format:
  11 usable zones
  Aggregate conventional zones: disabled
  File UID: 0
  File GID: 0
  File access permissions: 640
  FS UUID: 415db4cd-c6c8-4e39-8a6d-69d852cc8d55
Resetting sequential zones
Writing super block
cnv_mmapwr: (g=0): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=mmap, iodepth=1
fio-3.32
Starting 1 process
fio: pid=3462, err=22/file:engines/mmap.c:118, func=mmap, error=Invalid argument


Run status group 0 (all jobs):

Disk stats (read/write):
  vda: ios=0/0, merge=0/0, ticks=0/0, in_queue=0, util=0.00%
seqwrite: (g=0): rw=write, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=libaio, iodepth=64
fio-3.32
Starting 1 process
seqwrite: Laying out IO file (1 file / 64MiB)

seqwrite: (groupid=0, jobs=1): err= 0: pid=3466: Mon Jan 16 15:53:47 2023
  read: IOPS=2509, BW=627MiB/s (658MB/s)(64.0MiB/102msec)
    slat (nsec): min=6594, max=75183, avg=13634.75, stdev=5590.51
    clat (usec): min=373, max=25658, avg=19110.74, stdev=7823.76
     lat (usec): min=387, max=25670, avg=19124.38, stdev=7823.69
    clat percentiles (usec):
     |  1.00th=[  930],  5.00th=[ 3130], 10.00th=[ 5800], 20.00th=[10814],
     | 30.00th=[15795], 40.00th=[20841], 50.00th=[24773], 60.00th=[24773],
     | 70.00th=[25035], 80.00th=[25035], 90.00th=[25035], 95.00th=[25035],
     | 99.00th=[25560], 99.50th=[25560], 99.90th=[25560], 99.95th=[25560],
     | 99.99th=[25560]
  write: IOPS=2285, BW=571MiB/s (599MB/s)(64.0MiB/112msec); 0 zone resets
    slat (usec): min=395, max=1011, avg=432.01, stdev=65.86
    clat (usec): min=221, max=30301, avg=23196.65, stdev=6895.41
     lat (usec): min=637, max=31163, avg=23628.65, stdev=6908.88
    clat percentiles (usec):
     |  1.00th=[ 1057],  5.00th=[ 5276], 10.00th=[10683], 20.00th=[21365],
     | 30.00th=[26084], 40.00th=[26084], 50.00th=[26346], 60.00th=[26346],
     | 70.00th=[26346], 80.00th=[26346], 90.00th=[26608], 95.00th=[27657],
     | 99.00th=[29754], 99.50th=[30016], 99.90th=[30278], 99.95th=[30278],
     | 99.99th=[30278]
  lat (usec)   : 250=0.20%, 500=0.20%, 750=0.20%, 1000=0.39%
  lat (msec)   : 2=1.56%, 4=2.73%, 10=8.59%, 20=14.65%, 50=71.48%
  cpu          : usr=91.51%, sys=4.25%, ctx=519, majf=0, minf=22
  IO depths    : 1=0.4%, 2=0.8%, 4=1.6%, 8=3.1%, 16=6.2%, 32=12.5%, >=64=75.4%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=99.5%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.5%, >=64=0.0%
     issued rwts: total=256,256,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=627MiB/s (658MB/s), 627MiB/s-627MiB/s (658MB/s-658MB/s), io=64.0MiB (67.1MB), run=102-102msec
  WRITE: bw=571MiB/s (599MB/s), 571MiB/s-571MiB/s (599MB/s-599MB/s), io=64.0MiB (67.1MB), run=112-112msec

Disk stats (read/write):
  vda: ios=74/256, merge=0/0, ticks=142/56, in_queue=198, util=47.77%
Check sequential file mmap read
seq_rndrd: (g=0): rw=randread, bs=(R) 256KiB-256KiB, (W) 256KiB-256KiB, (T) 256KiB-256KiB, ioengine=mmap, iodepth=1
fio-3.32
Starting 1 process

seq_rndrd: (groupid=0, jobs=1): err= 0: pid=3481: Mon Jan 16 15:53:49 2023
  read: IOPS=157, BW=39.3MiB/s (41.2MB/s)(64.0MiB/1630msec)
    clat (usec): min=4070, max=25853, avg=5955.21, stdev=2642.68
     lat (usec): min=4070, max=25854, avg=5955.52, stdev=2642.80
    clat percentiles (usec):
     |  1.00th=[ 4113],  5.00th=[ 4293], 10.00th=[ 4359], 20.00th=[ 4555],
     | 30.00th=[ 4752], 40.00th=[ 4948], 50.00th=[ 5145], 60.00th=[ 5473],
     | 70.00th=[ 5669], 80.00th=[ 6063], 90.00th=[ 8586], 95.00th=[11338],
     | 99.00th=[17171], 99.50th=[19006], 99.90th=[25822], 99.95th=[25822],
     | 99.99th=[25822]
   bw (  KiB/s): min=34816, max=48640, per=98.48%, avg=39594.67, stdev=7837.67, samples=3
   iops        : min=  136, max=  190, avg=154.67, stdev=30.62, samples=3
  lat (msec)   : 10=92.58%, 20=7.03%, 50=0.39%
  cpu          : usr=7.31%, sys=9.02%, ctx=16488, majf=16384, minf=74
  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, >=64=0.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, >=64=0.0%
     issued rwts: total=256,0,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=1

Run status group 0 (all jobs):
   READ: bw=39.3MiB/s (41.2MB/s), 39.3MiB/s-39.3MiB/s (41.2MB/s-41.2MB/s), io=64.0MiB (67.1MB), run=1630-1630msec

Disk stats (read/write):
  vda: ios=13555/0, merge=0/0, ticks=1074/0, in_queue=1074, util=90.97%
PASS

